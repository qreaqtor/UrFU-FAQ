<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Профиль</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700;800&family=Roboto:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
  </head>

  <body>
    <header class="header">
      <div class="wrapper">
        <div class="header__container">
          <div class="header__logo"><p>Практика</p></div>
          <div class="header__search">
            <input type="text" name="header-search" placeholder="поиск...">
          </div>
          <nav class="header__menu">
            <div class="header__menu-item"><a class="header__menu-item-link" href="/">статьи</a></div>
            <div class="header__menu-item"><a class="header__menu-item-link" href="/write">создать</a></div>
            <div class="header__menu-item header__menu-item-active"><a class="header__menu-item-link" href="/profile">профиль</a></div>
          </nav>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="wrapper">
        <div class="main__continer">
            {% if user %}
                <div>
                    <p>Вы уже авторизованы как: {{ user.email }}</p>
                    <form id="logout-form" action="/auth/jwt/logout" method="POST">
                        <button type="submit">Выйти</button>
                    </form>
                </div>
            {% else %}
                <!-- регистрация -->
                <div class="main__sign-up sign-up">
                <div class="sign-up__title">Регистрация</div>
                <div class="sign-up__first-name sign-up__input-block">
                    <p class="sign-up__first-name-text sign-up__text">Имя</p>
                    <input class="sign-up__first-name-input sign-up__input" type="text" name="sign-up__first-name-input" placeholder="введите ваше имя...">
                </div>
                <div class="sign-up__second-name sign-up__input-block">
                    <p class="sign-up__second-name-text sign-up__text">Фамилия</p>
                    <input class="sign-up__second-name-input sign-up__input" type="text" name="sign-up__second-name-input" placeholder="введите вашу фамилию...">
                </div>
                <div class="sign-up__email sign-up__input-block">
                    <p class="sign-up__email-text sign-up__text">Электронная почта</p>
                    <input class="sign-up__email-input sign-up__input" type="email" name="sign-up__email-input" placeholder="введите вашу почту...">
                </div>
                <div class="sign-up__password sign-up__input-block">
                    <p class="sign-up__password-text sign-up__text">Пароль</p>
                    <input class="sign-up__password-input sign-up__input" type="password" name="sign-up__password-input" placeholder="введите пароль...">
                    <input class="sign-up__password-input sign-up__password-input_confirmation sign-up__input" type="password" name="sign-up__password-input_confirmation" placeholder="подтвердите пароль...">
                </div>

                <button class="sign-up__button" type="submit" name="sign-up__button">Создать аккаунт</button>
                <div class="sign-up__hint">
                    <div class="sign-up__hint-text">уже есть аккаунт?</div>
                    <div class="sign-up__hint-link"><a href="#">нажми сюда</a></div>
                </div>
                </div>
                
                <!-- вход -->
                <div class="main__login login">
                <div class="login__title">Вход</div>
                <div class="login__email login__input-block">
                    <p class="login__email-text login__text">Электронная почта</p>
                    <input class="login__email-input login__input" type="email" name="login__email-input" placeholder="введите вашу почту...">
                </div>
                <div class="login__password login__input-block">
                    <p class="login__password-text login__text">Пароль</p>
                    <input class="login__password-input login__input" type="password" name="login__password-input" placeholder="введите пароль...">
                </div>

                <button class="login__button" type="submit" name="login__button">Войти</button>
                <div class="login__hint">
                    <div class="login__hint-text">нет аккаунта?</div>
                    <div class="login__hint-link"><a href="#">нажми сюда</a></div>
                </div>
                </div>
            {% endif %}
      </div>
    </main>
  </body>

  <script src="js/main.js"></script>
</html>
<script>
    // Находим кнопку "Войти"
var loginButton = document.querySelector('.login__button');

// Добавляем обработчик события клика на кнопку "Войти"
loginButton.addEventListener('click', function(event) {
  event.preventDefault(); // Предотвращаем отправку формы по умолчанию

  // Получаем значения полей ввода
  var emailInput = document.querySelector('.login__email-input');
  var passwordInput = document.querySelector('.login__password-input');
  var email = emailInput.value;
  var password = passwordInput.value;

  // Создаем объект FormData и добавляем в него значения полей ввода
  var formData = new FormData();
  formData.append('username', email);
  formData.append('password', password);

  // Создаем объект запроса
  var request = new XMLHttpRequest();
  request.open('POST', '/auth/jwt/login');
  request.send(formData);

  // Обработка ответа сервера (вы можете настроить свою логику обработки здесь)
  request.onload = function() {
    if (request.status === 204) {
      // Успешный вход, обновление страницы или перенаправление на другую страницу
      alert("Успешный вход")
    } else {
      // Вход не удался, выполнение дополнительных действий (например, отображение ошибки)
      alert("Неудачный вход, попробуйте ещё раз")
    }
  };
});
</script>
<script>
    // Находим кнопку "Создать аккаунт"
var signUpButton = document.querySelector('.sign-up__button');

// Добавляем обработчик события клика на кнопку "Создать аккаунт"
signUpButton.addEventListener('click', function(event) {
  event.preventDefault(); // Предотвращаем отправку формы по умолчанию

  // Получаем значения полей ввода
  var firstNameInput = document.querySelector('.sign-up__first-name-input');
  var lastNameInput = document.querySelector('.sign-up__second-name-input');
  var emailInput = document.querySelector('.sign-up__email-input');
  var passwordInput = document.querySelector('.sign-up__password-input');
  var confirmPasswordInput = document.querySelector('.sign-up__password-input_confirmation');
  
  var firstName = firstNameInput.value;
  var lastName = lastNameInput.value;
  var email = emailInput.value;
  var password = passwordInput.value;
  var confirmPassword = confirmPasswordInput.value;

  // Создаем объект с данными для отправки
  var requestData = {
    email: email,
    password: password,
    is_active: true,
    is_superuser: false,
    is_verified: false,
    name: firstName,
    surname: lastName
  };

  // Создаем объект запроса
  var request = new XMLHttpRequest();
  request.open('POST', '/auth/register');
  request.setRequestHeader('Content-Type', 'application/json');

  // Отправляем запрос с данными в формате JSON
  request.send(JSON.stringify(requestData));

  // Обработка ответа сервера
  request.onload = function() {
    if (request.status === 201) {
      // Успешная регистрация, выполнение дополнительных действий (например, перенаправление на страницу успешной регистрации)
      alert('Успешная регистрация');
    } else {
      // Регистрация не удалась, выполнение дополнительных действий (например, отображение ошибки)
      alert('Ошибка регистрации, попробуйте ещё раз');
    }
  };
});

</script>